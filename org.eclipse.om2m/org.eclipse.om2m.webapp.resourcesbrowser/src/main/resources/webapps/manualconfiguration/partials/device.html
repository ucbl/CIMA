<!--Device view-->
<div  ng-hide='loading' ng-controller="DeviceCtrl">
	<div >
        <a class="btn btn-warning" href="#/"> < Devices list</a>
        <!-- Applying changes button-->
        <button class="btn btn-success pull-right" ng-click="saveDevice()">
            <i class="glyphicon glyphicon-ok"></i>
            Apply changes
        </button>
        <hr>
        <!-- Infos sur le device -->
        <div class="panel panel-primary">
            <div class="panel-heading">
                <h2 class="panel-title">Device ID : {{device.id}}</h2>
            </div>
            <div class="panel-body">
                <i>Configuration : {{device.configuration}}</i><br>
                <i>Last connection on {{device.dateConnection}}</i><br>
                <i>Communication protocol : {{device.modeConnection}} at {{device.uri}}</i>

                <br>
                <br>
                <p>
                    <div ng-show="!isDeviceNameEditable">
                        <strong>Name</strong> : {{device.name}}
                    </div>
                    <div ng-show="isDeviceNameEditable">
                        <strong>Name</strong>
                        <input class="control" type="text"  ng-disabled="!isEditable" ng-model="device.name"/> 
                        <input class="control" type="checkbox" ng-model="isEditable">Edit
                    </div>
                    <br>
                    <i ng-show="isEditable">Note : changes will be effective after apply changes.</i>
                </p>
                <hr>

                <!-- Devices capabilities -->
                <h3>Capabilities</h3>

                <table st-table="devices" class="table table-striped" style="width: 40%">
                   <thead>
                       <tr>
                        <th>Configuration </th>
                        <th>ID </th>
                        <th>Protocol</th>
                    </tr>
                </thead>
                <tbody ng-repeat="capability in device.capabilities | orderBy:order">
                   <tr>
                    <td>{{capability.configuration}}</td>
                    <td>{{capability.id}}</td>
                    <td>{{capability.protocol.protocolName}}</td>
                    <td>

                        <button ng-show="!capability.isEditable" type="button" ng-click="openAndShowCapability(capability)" class="btn btn-sm btn btn-info">
                            <i class="glyphicon glyphicon-show"></i>
                            Show
                        </button>

                        <button ng-show="capability.isEditable" type="button" ng-click="openAndEditCapability(capability)" class="btn btn-sm btn btn-info">
                          <i class="glyphicon glyphicon-edit"></i>
                          Edit
                      </button>
                  </td>
                  <td>
                    <button ng-show="capability.isEditable" type="submit" id="delete{{capability.id}}"
                    data-loading-text="deleting..." class="btn btn-sm btn-danger" autocomplete="off" onclick="javascript: id = this.value;"
                    value="{{capability.id}}" data-toggle="modal"
                    data-target="#confirm-delete">
                    <i class="glyphicon glyphicon-remove-circle"></i>
                    Remove
                </button>
                            <!--MODAL FOR REMOVING-->
<div class="modal fade" id="confirm-delete" tabindex="-1" role="dialog"
    aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"
                    aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">Confirm Delete</h4>
            </div>
            <div class="modal-body">
                <p>You are about to delete a capability, this procedure is
                    irreversible.</p>
                <p>Do you want to proceed?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger danger"
                    ng-click="removeCapability(capability)"data-dismiss="modal">Delete</button>
            </div>
        </div>
    </div>
</div>
                </td>
	         </tr>
	        </tbody>
	    </table>

                <!-- SHOW CAPACBILITY -->
                <div class="panel panel-warning" id="edit" ng-show="ShowIsOpen">
                    <div class="panel-heading">
                        <h2 class="panel-title">Show capability</h2>
                    </div>
                    <div class="panel-body">                
                            <strong>ID : {{editedCapability.id}} </strong>
                            <br><br>
                            <li>
                            <strong>Protocol type</strong> :  {{editedCapability.protocol.protocolName}}
 
                            </li>
                            <li ng-repeat="parameter in editedCapability.protocol.parameters">
                                <strong>{{parameter.name}}</strong> : {{parameter.value}}
                            </li>
                            <br>   
                            <strong>Key words :</strong>
                            <li ng-repeat="word in editedCapability.keywords">
                                {{word.text}}
                            </li>
                            <br>

                            <button class="btn btn-danger pull-left" type="button" ng-click="openAndShowCapability(null)" />
                                Close
                            </button>
                            <!-- Test capability button -->
                            <button ng-click="testCapability(editedCapability)" type="button" class="btn btn-primary pull-right">Test</button>
                            <br>
                    </div>
                </div>

            	<!-- EDIT CAPACBILITY -->
                <div class="panel panel-warning" id="edit" ng-show="EditIsOpen">
                    <div class="panel-heading">
                        <h2 class="panel-title">Edit capability</h2>
                    </div>
                    <div class="panel-body">                
                        <form ng-submit="modifyCapability(editedCapability)">
                            <strong>ID : {{editedCapability.id}} </strong>
                            <br><br>
                            <li>
                            Protocol type :  {{editedCapability.protocol.protocolName}}
                           <!-- <select class="form-control" ng-model="editedCapability.protocol"
                                            ng-options="protocol.protocolName for protocol in protocols" ng-required="true" ng-change ="SelectCapability($item)">-->

                            <select class="form-control" ng-model="editedCapability.protocol"
                                            ng-options="protocol.protocolName for protocol in protocolsFromEdited" ng-required="true">
                            </select>
                            </li>
                            <li ng-repeat="parameter in editedCapability.protocol.parameters">
                                        {{parameter.name}}:
                                        <input class="form-control"  style="width: 40%" type="text" ng-model="parameter.value">
                            </li>
                            <br>   
                            <li> Key words </li> 
                             <tags-input ng-model="editedCapability.keywords"></tags-input> 

                            <br>

                            <button class="btn btn-success pull-right" style="margin-left:5px" type="submit">
                                <i class="glyphicon glyphicon-ok"></i>
                                Apply 
                            </button>
                            <button class="btn btn-danger pull-left" type="button" ng-click="openAndEditCapability(null)" />
                                Undo
                            </button>
                            <!-- Test capability button -->
                            <button ng-click="testCapability(editedCapability)" type="button" class="btn btn-primary pull-right">Test</button>
                            <br>
                        </form>
                    </div>
                </div>




            </div>
        </div>

        <!-- ADD CAPABILITY -->
        <div class="addCapability panel panel-info">
            <div class="panel-heading">
                <h2 class="panel-title">Add a capability</h2>
            </div>
            <div class="panel-body">               
                <accordion>
                    <accordion-group>
                        <accordion-heading>
                            From existing one
                        </accordion-heading>                
                        <!-- From Existing -->
                        <input type="text" ng-model="NewFromExistingCapability" placeholder="search for a capability..." typeahead="capability as capability.id for capability in getCapability($viewValue) | filter:{id:$viewValue}" typeahead-loading="loadingCapabilities" typeahead-on-select="onSelectCapability($item, $model, $label)" class="form-control">
                        <i ng-show="loadingCapabilities" class="glyphicon glyphicon-refresh"></i>
                        <!--<pre>Model: {{NewFromExistingCapability | json}}</pre>-->
                        <form name = "addFromExisting" ng-submit="addCapabilityFromExisting(NewFromExistingCapability)" ng-show="(NewFromExistingCapability != '' && NewFromExistingCapability != null )">
                            <strong>ID </strong><span class=" btn-danger" ng-show="idrequired">You must specify a new ID !</span>
                            <input name="id" class="form-control" style="width: 40%" type="text" placeholder="Type an ID... (Required)" ng-model="NewFromExistingCapability.id" id required>
                            <strong>Protocol </strong>
                            <select class="form-control" ng-model="NewFromExistingCapability.protocol"
                                    ng-options="protocol.protocolName for protocol in protocolsFromExisting" ng-required="true">
                            </select>
                            <li ng-repeat="parameter in NewFromExistingCapability.protocol.parameters">
                                {{parameter.name}}:
                                <input class="form-control"  type="text" ng-model="parameter.value">
                            </li>
                            <br>
                             <strong>Key words </strong>
                             <tags-input ng-model="NewFromExistingCapability.keywords"></tags-input>                   
                             <!-- Reset capability button -->
                            <button ng-click="NewFromExistingCapability={}" type="button" class="btn btn-primary pull-left" >Reset</button>
                             <!-- Add capability button -->
                            <button style="margin-left:5px" class="btn btn-success pull-right" type="submit" >Add</button>
                            <!-- Test capability button -->
                            <button ng-click="testCapability(NewFromExistingCapability)" type="button" class="btn btn-primary pull-right">Test</button>
                        </form>
                    </accordion-group>

                    <accordion-group>
                        <accordion-heading>
                        New one
                        <!--Create a new capability-->
                        </accordion-heading >
                        <form ng-submit="addCapability(newCapability)">
                            <strong>ID </strong>
                            <input class="form-control" style="width: 40%" type="text" placeholder="Type an ID... (Required)" ng-model="newCapability.id" required>

                            <strong>Protocol </strong>
                            <select class="form-control" ng-model="newCapability.protocol"
                                    ng-options="protocol.protocolName for protocol in protocols" required>
                                <option value=""> -- Choose protocol --</option>
                            </select>
                            <li ng-repeat="parameter in newCapability.protocol.parameters">
                                {{parameter.name}}:
                                <input class="form-control" style="width: 40%" type="text" ng-model="parameter.value">
                            </li>
                            <br>        

                             <strong>Key words </strong>
                             <tags-input ng-model="newCapability.keywords"></tags-input> 
                             <br>                
                             <!-- Reset capability button -->
                            <button ng-click="newCapability={}" type="button" class="btn btn-primary pull-left">Reset</button> 
                             <!-- Add capability button -->
                            <input style="margin-left:5px" class="btn btn-success pull-right" type="submit" value="Add"/>
                             <!-- Test capability button -->
                            <button ng-click="testCapability(newCapability)" type="button" class="btn btn-primary pull-right">Test</button>
                        </form>
                    </accordion-group>
                </accordion>
            </div> 
        </div> 
    </div> 
</div>